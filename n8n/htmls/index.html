<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Helix-Lite-Alpha Container Health</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">
    âš¡ Helix-Lite-Alpha Container Health
  </h1>
  <div class="overflow-x-auto">
    <table class="table-auto w-full border-collapse text-sm">
      <thead>
        <tr class="bg-gray-700 text-left">
          <th class="p-3">Name</th>
          <th class="p-3">Status</th>
          <th class="p-3">Ports</th>
        </tr>
      </thead>
      <tbody id="container-rows"></tbody>
    </table>
  </div>

  <script>
    const tbody = document.getElementById('container-rows');

    async function loadData() {
      const res = await fetch('containers.json?_=' + Date.now());
      const data = await res.json();
      tbody.innerHTML = '';

      data.forEach(c => {
        const tr = document.createElement('tr');
        tr.className = "border-b border-gray-700 hover:bg-gray-800";

        // Name
        const name = document.createElement('td');
        name.className = "p-3 font-mono";
        name.textContent = c.Names;
        tr.appendChild(name);

        // Status with emoji
        const status = document.createElement('td');
        status.className = "p-3";
        const s = c.Status.toLowerCase();
        let emoji = "âš«";
        if (s.includes("healthy")) emoji = "ðŸŸ¢";
        else if (s.includes("unhealthy")) emoji = "ðŸ”´";
        else if (s.includes("up")) emoji = "ðŸŸ¡";
        status.innerHTML = `${emoji} <span class="ml-1" title="${c.Status}">${c.Status}</span>`;
        tr.appendChild(status);

        // Ports -> clickable links
        const ports = document.createElement('td');
        ports.className = "p-3 space-x-2";
        const matches = c.Ports.matchAll(/([\d\.:\[\]]+)->(\d+)\/tcp/g);
        for (const m of matches) {
          const host = m[1].split(':')[1] || m[1];  // handle IPv6
          const port = m[2];
          // choose http/https if common web port
          let scheme = '';
          if (["80","8080","3000","5050","5678","9000"].includes(port)) scheme = 'http';
          if (["443","8443","9443"].includes(port)) scheme = 'https';

          if (scheme) {
            const a = document.createElement('a');
            a.href = `${scheme}://${window.location.hostname}:${port}`;
            a.target = "_blank";
            a.className = "text-blue-400 underline hover:text-blue-200";
            a.textContent = `${scheme}://${port}`;
            ports.appendChild(a);
          } else {
            const span = document.createElement('span');
            span.textContent = port;
            ports.appendChild(span);
          }
        }
        tr.appendChild(ports);
        tbody.appendChild(tr);
      });
    }

    loadData();
    setInterval(loadData, 30000); // refresh every 30s
  </script>
</body>
</html>
